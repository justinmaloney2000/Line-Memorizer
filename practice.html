<!DOCTYPE html>
<html>
<head>
  <title>Practice Lines</title>

  <style>
    body {
      background: #0f0f0f;
      color: white;
      font-family: Arial;
      padding: 30px;
      text-align: center;
    }
    .box {
      background: #1c1c1c;
      padding: 20px;
      border-radius: 10px;
      max-width: 650px;
      margin: auto;
    }
    .cue {
      color: #aaa;
      font-style: italic;
      margin-bottom: 10px;
    }
    textarea, input {
      width: 100%;
      font-size: 16px;
      margin-top: 10px;
      padding: 8px;
    }
    button {
      margin-top: 10px;
      padding: 8px 14px;
    }
    .hint {
      color: #4da6ff;
      display: none;
      margin-top: 10px;
    }
    .correct { color: #4caf50; }
    .wrong { color: #ff6b6b; }
    a {
      color: #4da6ff;
      text-decoration: none;
      display: block;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>

<a href="index.html">‚¨Ö Back</a>

<h1>üé≠ Start Practicing</h1>

<div class="box">

  <input id="characterName" placeholder="Enter your character name (e.g. ALEX)">
  <button onclick="startPractice()">Start</button>

  <div class="cue"></div>

  <textarea id="userInput" placeholder="Type your line..."></textarea>

  <br>
  <button onclick="checkLine()">Check</button>
  <button onclick="showHint()">Hint</button>

  <div id="hint" class="hint"></div>
  <div id="feedback"></div>
</div>

<script>
const scannedText = localStorage.getItem("scannedScript") || "";
const allLines = scannedText.split("\n").map(l => l.trim()).filter(Boolean);

let practicePairs = [];
let current = 0;

function normalize(t) {
  return t.toLowerCase().replace(/[^\w\s]/g, "").trim();
}

function startPractice() {
  const character = document.getElementById("characterName").value.trim().toUpperCase();
  if (!character) return alert("Enter a character name.");

  practicePairs = [];

  for (let i = 1; i < allLines.length; i++) {
    if (allLines[i].toUpperCase().startsWith(character + ":")) {
      practicePairs.push({
        cue: allLines[i - 1],
        line: allLines[i].split(":").slice(1).join(":").trim()
      });
    }
  }

  if (practicePairs.length === 0) {
    alert("No lines found for that character.");
    return;
  }

  current = 0;
  loadLine();
}

function loadLine() {
  if (current >= practicePairs.length) {
    document.querySelector(".cue").textContent = "üéâ All lines completed!";
    return;
  }

  document.querySelector(".cue").textContent =
    "Cue line: ‚Äú" + practicePairs[current].cue + "‚Äù";

  document.getElementById("userInput").value = "";
  document.getElementById("feedback").textContent = "";
}

function checkLine() {
  const input = document.getElementById("userInput").value;
  const correct = practicePairs[current].line;

  if (normalize(input) === normalize(correct)) {
    document.getElementById("feedback").innerHTML =
      "<div class='correct'>‚úî Correct</div>";
    current++;
    setTimeout(loadLine, 900);
  } else {
    document.getElementById("feedback").innerHTML =
      "<div class='wrong'>Try again</div>";
  }
}

function showHint() {
  const words = practicePairs[current].line.split(" ");
  const hint = words.slice(0, 3).join(" ") + "...";

  const h = document.getElementById("hint");
  h.textContent = hint;
  h.style.display = "block";

  setTimeout(() => h.style.display = "none", 3000);
}
</script>

</body>
</html>
